{
  "file_name": "code_quality_report.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\code_quality_report.py",
  "file_size": 5520,
  "created": "2025-12-04T17:28:47.959110",
  "modified": "2025-12-04T20:24:39.756133",
  "file_type": "code",
  "content_hash": "9f0b44cf0f3c86e50b43854afd332490",
  "content_type": "text",
  "content": "\"\"\"\nCode Quality Analysis for Hypercode Project\n\nThis script analyzes and reports on:\n1. Documentation coverage\n2. Test coverage\n3. Code quality opportunities\n\"\"\"\n\nfrom typing import Any, Dict, List\n\nfrom hypercode_db import CodeEntity, HypercodeDB\n\n\ndef get_undocumented_classes_priority(db: HypercodeDB) -> List[CodeEntity]:\n    \"\"\"Get undocumented classes sorted by importance (more methods = higher priority).\"\"\"\n    return sorted(\n        (\n            c\n            for c in db.entities\n            if (\n                c.type == \"class\"\n                and hasattr(c, \"methods\")\n                and c.methods\n                and not (getattr(c, \"docstring\", \"\") or \"\").strip()\n            )\n        ),\n        key=lambda x: len(x.methods),\n        reverse=True,\n    )\n\n\ndef get_least_tested_files(db: HypercodeDB) -> List[Dict[str, Any]]:\n    \"\"\"Get files with most code but least test coverage.\n\n    Returns:\n        List of dictionaries containing file test metrics, sorted by test ratio\n    \"\"\"\n    file_metrics = [\n        {\n            \"file\": file,\n            \"test_count\": sum(\n                1\n                for e in entities\n                if e.type == \"function\" and e.name.lower().startswith(\"test_\")\n            ),\n            \"code_entities\": len(\n                [e for e in entities if e.type in (\"function\", \"class\")]\n            ),\n        }\n        for file, entities in db.by_file.items()\n        if (\n            file.endswith(\".py\")\n            and \"test\" not in file.lower()\n            and \"venv\" not in file.lower()\n            and any(e.type in (\"function\", \"class\") for e in entities)\n        )\n    ]\n\n    # Calculate test ratio and filter out files with no code entities\n    for fm in file_metrics:\n        fm[\"test_ratio\"] = fm[\"test_count\"] / max(1, fm[\"code_entities\"])\n\n    return sorted(file_metrics, key=lambda x: x[\"test_ratio\"])[:10]\n\n    return sorted(file_metrics, key=lambda x: (x[\"test_ratio\"], -x[\"code_entities\"]))\n\n\ndef find_getter_methods(db: HypercodeDB) -> List[Dict[str, Any]]:\n    \"\"\"Find get_ methods that could be converted to properties.\n\n    Returns:\n        List of dictionaries containing information about potential getter methods\n        that could be converted to properties.\n    \"\"\"\n    # Create a set of all function names for O(1) lookups\n    function_set = {(e.name, e.file) for e in db.entities if e.type == \"function\"}\n\n    potential_getters = []\n\n    for entity in db.entities:\n        if (\n            entity.type == \"function\"\n            and entity.name.startswith(\"get_\")\n            and len(entity.name) > 4\n        ):  # Ensure there's more after \"get_\"\n            # Check for corresponding setter\n            potential_setter = entity.name.replace(\"get_\", \"set_\", 1)\n            has_setter = (potential_setter, entity.file) in function_set\n\n            potential_getters.append(\n                {\n                    \"name\": entity.name,\n                    \"file\": entity.file,\n                    \"lineno\": entity.lineno,\n                    \"has_setter\": has_setter,\n                }\n            )\n\n    return potential_getters\n\n\ndef generate_code_quality_report(db_path: str = \"HYPER_DATABASE.json\"):\n    \"\"\"Generate a comprehensive code quality report.\"\"\"\n    print(\"Loading database for code quality analysis...\")\n    db = HypercodeDB(db_path)\n\n    # 1. Documentation Analysis\n    print(\"\\n=== DOCUMENTATION ANALYSIS ===\")\n    undocumented = get_undocumented_classes_priority(db)\n    print(f\"\\nTop 10 undocumented classes by complexity (out of {len(undocumented)}):\")\n    for i, cls in enumerate(undocumented[:10], 1):\n        methods = (\n            f\"{len(cls.methods)} methods\" if hasattr(cls, \"methods\") else \"no methods\"\n        )\n        print(f\"{i}. {cls.name} ({methods}) in {cls.file}\")\n\n    # 2. Test Coverage Analysis\n    print(\"\\n=== TEST COVERAGE ANALYSIS ===\")\n    test_metrics = get_least_tested_files(db)\n    print(\"\\nTop 10 files needing test coverage (by code size and test ratio):\")\n    for i, tm in enumerate(test_metrics[:10], 1):\n        print(f\"{i}. {tm['file']}\")\n        print(\n            f\"   Code Entities: {tm['code_entities']}, Tests: {tm['test_count']}, \"\n            f\"Test Ratio: {tm['test_ratio']:.1%}\"\n        )\n\n    # 3. Code Quality Analysis\n    print(\"\\n=== CODE QUALITY SUGGESTIONS ===\")\n    getter_methods = find_getter_methods(db)\n    print(f\"\\nFound {len(getter_methods)} classes with potential getter methods\")\n    print(\"\\nTop candidates for @property conversion:\")\n    for i, item in enumerate(getter_methods[:10], 1):\n        print(f\"\\n{i}. Class: {item['class']} (in {item['file']})\")\n        print(f\"   Getters: {', '.join(item['getters'])}\")\n        # Show example of conversion\n        for getter in item[\"getters\"][:2]:  # Show first 2 getters as examples\n            prop_name = getter[4:]  # Remove 'get_'\n            print(f\"     - Convert: {getter}() -> @property def {prop_name}\")\n\n    print(\"\\n=== RECOMMENDED ACTIONS ===\")\n    print(\"1. Document core classes starting with the most complex ones\")\n    print(\"2. Add tests for files with high code complexity but low test coverage\")\n    print(\"3. Convert simple getter methods to @property decorators\")\n    print(\n        \"\\nUse the interactive search in hypercode_db.py to explore specific findings.\"\n    )\n\n\nif __name__ == \"__main__\":\n    generate_code_quality_report()\n",
  "metadata": {},
  "relative_path": "code_quality_report.py",
  "id": "e56ec9f2308abc5cb0457ea190981cf5"
}