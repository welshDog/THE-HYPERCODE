{
  "file_name": "index_command.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\venv_new\\Lib\\site-packages\\pip\\_internal\\cli\\index_command.py",
  "file_size": 5677,
  "created": "2025-12-01T01:58:29.972399",
  "modified": "2025-12-01T01:58:29.972913",
  "file_type": "code",
  "content_hash": "7f092b5e7db5206c8a8f104df60b5177",
  "content_type": "text",
  "content": "\"\"\"\nContains command classes which may interact with an index / the network.\n\nUnlike its sister module, req_command, this module still uses lazy imports\nso commands which don't always hit the network (e.g. list w/o --outdated or\n--uptodate) don't need waste time importing PipSession and friends.\n\"\"\"\n\nimport logging\nimport os\nimport sys\nfrom optparse import Values\nfrom typing import TYPE_CHECKING, List, Optional\n\nfrom pip._vendor import certifi\n\nfrom pip._internal.cli.base_command import Command\nfrom pip._internal.cli.command_context import CommandContextMixIn\n\nif TYPE_CHECKING:\n    from ssl import SSLContext\n\n    from pip._internal.network.session import PipSession\n\nlogger = logging.getLogger(__name__)\n\n\ndef _create_truststore_ssl_context() -> Optional[\"SSLContext\"]:\n    if sys.version_info < (3, 10):\n        logger.debug(\"Disabling truststore because Python version isn't 3.10+\")\n        return None\n\n    try:\n        import ssl\n    except ImportError:\n        logger.warning(\"Disabling truststore since ssl support is missing\")\n        return None\n\n    try:\n        from pip._vendor import truststore\n    except ImportError:\n        logger.warning(\"Disabling truststore because platform isn't supported\")\n        return None\n\n    ctx = truststore.SSLContext(ssl.PROTOCOL_TLS_CLIENT)\n    ctx.load_verify_locations(certifi.where())\n    return ctx\n\n\nclass SessionCommandMixin(CommandContextMixIn):\n    \"\"\"\n    A class mixin for command classes needing _build_session().\n    \"\"\"\n\n    def __init__(self) -> None:\n        super().__init__()\n        self._session: Optional[PipSession] = None\n\n    @classmethod\n    def _get_index_urls(cls, options: Values) -> Optional[List[str]]:\n        \"\"\"Return a list of index urls from user-provided options.\"\"\"\n        index_urls = []\n        if not getattr(options, \"no_index\", False):\n            url = getattr(options, \"index_url\", None)\n            if url:\n                index_urls.append(url)\n        urls = getattr(options, \"extra_index_urls\", None)\n        if urls:\n            index_urls.extend(urls)\n        # Return None rather than an empty list\n        return index_urls or None\n\n    def get_default_session(self, options: Values) -> \"PipSession\":\n        \"\"\"Get a default-managed session.\"\"\"\n        if self._session is None:\n            self._session = self.enter_context(self._build_session(options))\n            # there's no type annotation on requests.Session, so it's\n            # automatically ContextManager[Any] and self._session becomes Any,\n            # then https://github.com/python/mypy/issues/7696 kicks in\n            assert self._session is not None\n        return self._session\n\n    def _build_session(\n        self,\n        options: Values,\n        retries: Optional[int] = None,\n        timeout: Optional[int] = None,\n    ) -> \"PipSession\":\n        from pip._internal.network.session import PipSession\n\n        cache_dir = options.cache_dir\n        assert not cache_dir or os.path.isabs(cache_dir)\n\n        if \"legacy-certs\" not in options.deprecated_features_enabled:\n            ssl_context = _create_truststore_ssl_context()\n        else:\n            ssl_context = None\n\n        session = PipSession(\n            cache=os.path.join(cache_dir, \"http-v2\") if cache_dir else None,\n            retries=retries if retries is not None else options.retries,\n            trusted_hosts=options.trusted_hosts,\n            index_urls=self._get_index_urls(options),\n            ssl_context=ssl_context,\n        )\n\n        # Handle custom ca-bundles from the user\n        if options.cert:\n            session.verify = options.cert\n\n        # Handle SSL client certificate\n        if options.client_cert:\n            session.cert = options.client_cert\n\n        # Handle timeouts\n        if options.timeout or timeout:\n            session.timeout = timeout if timeout is not None else options.timeout\n\n        # Handle configured proxies\n        if options.proxy:\n            session.proxies = {\n                \"http\": options.proxy,\n                \"https\": options.proxy,\n            }\n            session.trust_env = False\n            session.pip_proxy = options.proxy\n\n        # Determine if we can prompt the user for authentication or not\n        session.auth.prompting = not options.no_input\n        session.auth.keyring_provider = options.keyring_provider\n\n        return session\n\n\ndef _pip_self_version_check(session: \"PipSession\", options: Values) -> None:\n    from pip._internal.self_outdated_check import pip_self_version_check as check\n\n    check(session, options)\n\n\nclass IndexGroupCommand(Command, SessionCommandMixin):\n    \"\"\"\n    Abstract base class for commands with the index_group options.\n\n    This also corresponds to the commands that permit the pip version check.\n    \"\"\"\n\n    def handle_pip_version_check(self, options: Values) -> None:\n        \"\"\"\n        Do the pip version check if not disabled.\n\n        This overrides the default behavior of not doing the check.\n        \"\"\"\n        # Make sure the index_group options are present.\n        assert hasattr(options, \"no_index\")\n\n        if options.disable_pip_version_check or options.no_index:\n            return\n\n        try:\n            # Otherwise, check if we're using the latest version of pip available.\n            session = self._build_session(\n                options,\n                retries=0,\n                timeout=min(5, options.timeout),\n            )\n            with session:\n                _pip_self_version_check(session, options)\n        except Exception:\n            logger.warning(\"There was an error checking the latest version of pip.\")\n            logger.debug(\"See below for error\", exc_info=True)\n",
  "metadata": {},
  "relative_path": "venv_new\\Lib\\site-packages\\pip\\_internal\\cli\\index_command.py",
  "id": "f505917827b783309f97a76d15cea651"
}