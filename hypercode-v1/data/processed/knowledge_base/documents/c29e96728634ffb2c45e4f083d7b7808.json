{
  "file_name": "enhanced_perplexity_client.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\src\\core\\hypercode-\\src\\hypercode\\enhanced_perplexity_client.py",
  "file_size": 8643,
  "created": "2025-11-18T01:05:53.700738",
  "modified": "2025-11-18T19:47:10.917730",
  "file_type": "code",
  "content_hash": "61950c746553f4b2c8bff54f52c4021e",
  "content_type": "text",
  "content": "#!/usr/bin/env python3\n\"\"\"\nEnhanced Perplexity Client with Knowledge Base Integration\nProvides context-aware queries using HyperCode research data\n\"\"\"\n\nimport sys\nfrom pathlib import Path\nfrom typing import Any, Dict, List, Optional\n\n# Add parent directory for imports\nsys.path.insert(0, str(Path(__file__).parent.parent))\n\nfrom hypercode.knowledge_base import HyperCodeKnowledgeBase\nfrom hypercode.perplexity_client import PerplexityClient\n\n\nclass EnhancedPerplexityClient:\n    \"\"\"Enhanced Perplexity client with knowledge base integration\"\"\"\n\n    def __init__(self, kb_path: str = \"data/hypercode_knowledge_base.json\"):\n        self.perplexity = PerplexityClient()\n        self.knowledge_base = HyperCodeKnowledgeBase(kb_path)\n\n    def query_with_context(\n        self, prompt: str, use_knowledge_base: bool = True, model: str = \"sonar-pro\"\n    ) -> Dict:\n        \"\"\"Send a query with relevant knowledge base context\"\"\"\n\n        if use_knowledge_base:\n            # Get relevant context from knowledge base\n            context = self.knowledge_base.get_context_for_query(prompt)\n\n            # Build enhanced prompt with context\n            enhanced_prompt = f\"\"\"\n            You are HyperCode AI, an expert assistant for the HyperCode programming language project.\n\n            Use the following research data to inform your response:\n\n            {context}\n\n            User Query: {prompt}\n\n            Please provide a comprehensive response that:\n            1. Directly addresses the user's query\n            2. Incorporates relevant information from the research data\n            3. Provides practical insights for the HyperCode project\n            4. Suggests next steps or implementation considerations where appropriate\n            \"\"\"\n        else:\n            enhanced_prompt = f\"\"\"\n            You are HyperCode AI, an expert assistant for the HyperCode programming language project.\n\n            User Query: {prompt}\n\n            Please provide a comprehensive response for the HyperCode project.\n            \"\"\"\n\n        return self.perplexity.query(enhanced_prompt, model)\n\n    def add_research_data(\n        self,\n        title: str,\n        content: str,\n        url: Optional[str] = None,\n        tags: List[str] = None,\n    ) -> str:\n        \"\"\"Add research data to the knowledge base\"\"\"\n        return self.knowledge_base.add_document(title, content, url, tags)\n\n    def search_research_data(self, query: str, limit: int = 5) -> List[Any]:\n        \"\"\"Search the knowledge base\"\"\"\n        return self.knowledge_base.search_documents(query, limit)\n\n    def list_research_documents(self) -> List[Any]:\n        \"\"\"List all research documents\"\"\"\n        return self.knowledge_base.list_documents()\n\n    def get_document(self, doc_id: str) -> Optional[Any]:\n        \"\"\"Get a specific document\"\"\"\n        return self.knowledge_base.get_document(doc_id)\n\n    def delete_document(self, doc_id: str) -> bool:\n        \"\"\"Delete a document\"\"\"\n        return self.knowledge_base.delete_document(doc_id)\n\n    def import_from_perplexity_space(self, space_data: Dict) -> int:\n        \"\"\"Import data from Perplexity Space export\"\"\"\n        \"\"\"\n        Expected format for space_data:\n        {\n            \"documents\": [\n                {\n                    \"title\": \"Document Title\",\n                    \"content\": \"Document content...\",\n                    \"url\": \"optional_url\",\n                    \"tags\": [\"tag1\", \"tag2\"]\n                },\n                ...\n            ]\n        }\n        \"\"\"\n        imported_count = 0\n\n        if \"documents\" in space_data:\n            for doc in space_data[\"documents\"]:\n                try:\n                    self.add_research_data(\n                        title=doc.get(\"title\", \"Untitled Document\"),\n                        content=doc.get(\"content\", \"\"),\n                        url=doc.get(\"url\"),\n                        tags=doc.get(\"tags\", []),\n                    )\n                    imported_count += 1\n                except Exception as e:\n                    print(\n                        f\"‚ùå Error importing document '{doc.get('title', 'Unknown')}': {e}\"\n                    )\n\n        print(f\"‚úÖ Imported {imported_count} documents from Perplexity Space\")\n        return imported_count\n\n    def test_context_integration(self) -> bool:\n        \"\"\"Test the context integration\"\"\"\n        print(\"üß™ Testing context integration...\")\n\n        test_queries = [\n            \"What are the key features of HyperCode?\",\n            \"How does HyperCode support neurodivergent developers?\",\n            \"What backends does HyperCode support?\",\n            \"Explain the spatial programming paradigm\",\n        ]\n\n        for i, query in enumerate(test_queries, 1):\n            print(f\"\\nüîç Test Query {i}: {query}\")\n\n            # Test with context\n            response_with_context = self.query_with_context(\n                query, use_knowledge_base=True\n            )\n\n            # Test without context\n            response_without_context = self.query_with_context(\n                query, use_knowledge_base=False\n            )\n\n            # Compare responses\n            with_context_content = \"\"\n            without_context_content = \"\"\n\n            if \"choices\" in response_with_context and response_with_context[\"choices\"]:\n                with_context_content = response_with_context[\"choices\"][0][\"message\"][\n                    \"content\"\n                ]\n                print(f\"‚úÖ With context: {with_context_content[:100]}...\")\n\n            if (\n                \"choices\" in response_without_context\n                and response_without_context[\"choices\"]\n            ):\n                without_context_content = response_without_context[\"choices\"][0][\n                    \"message\"\n                ][\"content\"]\n                print(f\"üìù Without context: {without_context_content[:100]}...\")\n\n            # Check if context added value\n            if len(with_context_content) > len(without_context_content):\n                print(\"‚úÖ Context enhanced the response\")\n            else:\n                print(\"‚ö†Ô∏è Context may not have added significant value\")\n\n        return True\n\n\ndef create_perplexity_space_import_template():\n    \"\"\"Create a template for importing Perplexity Space data\"\"\"\n    template = {\n        \"documents\": [\n            {\n                \"title\": \"Example: HyperCode Overview\",\n                \"content\": \"\"\"\n                HyperCode is a revolutionary programming language designed for neurodivergent developers.\n                It features multiple syntax modes, AI integration, and advanced compilation backends.\n                Key innovations include spatial programming, natural language interfaces, and\n                built-in accessibility features.\n                \"\"\",\n                \"url\": \"https://www.perplexity.ai/spaces/hypercode-8B7p3SNcRcWhtGCk5ZGzjQ\",\n                \"tags\": [\"overview\", \"introduction\", \"concepts\"],\n            },\n            {\n                \"title\": \"Example: Implementation Roadmap\",\n                \"content\": \"\"\"\n                Phase 1: Core language specification and basic compiler\n                Phase 2: AI integration and neurodivergent features\n                Phase 3: Multi-backend support (quantum, DNA)\n                Phase 4: Spatial programming paradigm\n                Phase 5: Natural language programming\n                \"\"\",\n                \"url\": None,\n                \"tags\": [\"roadmap\", \"implementation\", \"phases\"],\n            },\n        ]\n    }\n\n    import json\n\n    with open(\"perplexity_space_import_template.json\", \"w\") as f:\n        json.dump(template, f, indent=2)\n\n    print(\"üìÑ Created perplexity_space_import_template.json\")\n    print(\"   Use this as a template for importing your Perplexity Space data\")\n\n\nif __name__ == \"__main__\":\n    # Initialize the enhanced client\n    client = EnhancedPerplexityClient()\n\n    # Test the integration\n    client.test_context_integration()\n\n    # Create import template\n    create_perplexity_space_import_template()\n\n    print(\"\\nüéâ Enhanced Perplexity Client is ready!\")\n    print(\"\\nüìã Next steps:\")\n    print(\"   1. Export your Perplexity Space data\")\n    print(\"   2. Use client.import_from_perplexity_space() to import it\")\n    print(\"   3. Use client.query_with_context() for context-aware queries\")\n    print(\"   4. Add new research data with client.add_research_data()\")\n",
  "metadata": {},
  "relative_path": "src\\core\\hypercode-\\src\\hypercode\\enhanced_perplexity_client.py",
  "id": "c29e96728634ffb2c45e4f083d7b7808"
}