{
  "file_name": "hypercode_db.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\hypercode_db.py",
  "file_size": 5365,
  "created": "2025-12-04T16:41:04.131574",
  "modified": "2025-12-04T20:43:55.759806",
  "file_type": "code",
  "content_hash": "15aa4fe0437b1ad6759c409989b8ef2a",
  "content_type": "text",
  "content": "\"\"\"\nHypercode Database - In-memory database for querying Hypercode project data.\n\"\"\"\n\nimport json\nfrom collections import defaultdict\nfrom dataclasses import dataclass\nfrom typing import Dict, List\n\n\n@dataclass\nclass CodeEntity:\n    \"\"\"Represents a code entity (class, function, etc.) in the database.\"\"\"\n\n    id: str\n    type: str\n    name: str\n    file: str\n    lineno: int\n    docstring: str = \"\"\n    methods: List[str]\n\n    def __post_init__(self):\n        \"\"\"Validate the entity after initialization.\"\"\"\n        pass\n\n\nclass HypercodeDB:\n    \"\"\"In-memory database for Hypercode project analysis.\n\n    This class provides efficient querying and analysis of code entities\n    loaded from a JSON database file.\n    \"\"\"\n\n    def __init__(self, db_path: str = \"HYPER_DATABASE.json\") -> None:\n        \"\"\"Initialize the database with the given JSON file.\n\n        Args:\n            db_path: Path to the JSON database file\n        \"\"\"\n        self.entities: List[CodeEntity] = []\n        self.by_type: Dict[str, List[CodeEntity]] = defaultdict(list)\n        self.by_file: Dict[str, List[CodeEntity]] = defaultdict(list)\n        self._load_database(db_path)\n\n    def _load_database(self, db_path: str) -> None:\n        \"\"\"Load the database from a JSON file.\n\n        Args:\n            db_path: Path to the JSON database file\n        \"\"\"\n        try:\n            with open(db_path, \"r\", encoding=\"utf-8\") as f:\n                data = json.load(f)\n\n            if not isinstance(data, dict) or \"entities\" not in data:\n                raise ValueError(\n                    f\"Invalid database format in '{db_path}'. \"\n                    \"Expected a dictionary with 'entities' key.\"\n                )\n\n            for i, entity_data in enumerate(data.get(\"entities\", []), 1):\n                try:\n                    entity = CodeEntity(\n                        id=entity_data.get(\"id\", \"\"),\n                        type=entity_data.get(\"type\", \"\"),\n                        name=entity_data.get(\"name\", \"\"),\n                        file=entity_data.get(\"file\", \"\"),\n                        lineno=entity_data.get(\"lineno\", 0),\n                        docstring=entity_data.get(\"docstring\", \"\"),\n                        methods=entity_data.get(\"methods\", []),\n                    )\n                    self.entities.append(entity)\n                    self.by_type[entity.type].append(entity)\n                    self.by_file[entity.file].append(entity)\n                except Exception as e:\n                    print(\n                        f\"Warning: Failed to load entity #{i} from {db_path}: {str(e)}\"\n                    )\n                    continue\n\n        except FileNotFoundError as e:\n            raise FileNotFoundError(f\"Database file not found: {db_path}\") from e\n        except json.JSONDecodeError as e:\n            raise json.JSONDecodeError(\n                f\"Invalid JSON in database file '{db_path}': {str(e)}\", e.doc, e.pos\n            ) from e\n        except Exception as e:\n            raise RuntimeError(\n                f\"Failed to load database from {db_path}: {str(e)}\"\n            ) from e\n\n    def get_entities_by_type(self, entity_type: str) -> List[CodeEntity]:\n        \"\"\"Get all entities of a specific type.\n\n        Args:\n            entity_type: The type of entities to retrieve (e.g., 'function', 'class')\n\n        Returns:\n            List of matching CodeEntity objects\n        \"\"\"\n        return self.by_type.get(entity_type, []).copy()\n\n    def get_entities_in_file(self, file_path: str) -> List[CodeEntity]:\n        \"\"\"Get all entities in a specific file.\n\n        Args:\n            file_path: Path to the file\n\n        Returns:\n            List of CodeEntity objects in the file\n        \"\"\"\n        return self.by_file.get(file_path, []).copy()\n\n\ndef print_analysis(db: HypercodeDB) -> None:\n    \"\"\"Print a detailed analysis of the codebase.\n\n    Args:\n        db: Initialized HypercodeDB instance\n    \"\"\"\n    if not isinstance(db, HypercodeDB):\n        raise TypeError(\"Expected db to be an instance of HypercodeDB\")\n    print(\"\\n\" + \"=\" * 50)\n    print(\"HYPERCODE CODEBASE ANALYSIS\")\n    print(\"=\" * 50)\n\n\n# Example usage\nif __name__ == \"__main__\":\n    # Initialize the database\n    print(\"Loading database...\")\n    db = HypercodeDB(\"HYPER_DATABASE.json\")\n\n    # Run the analysis\n    print_analysis(db)\n\n    # Interactive search example\n    print(\"\\n[SEARCH] Try searching for entities (e.g., 'test', 'parse', 'handle'):\")\n    while True:\n        search_term = input(\"\\nSearch term (or 'quit' to exit): \").strip()\n        if search_term.lower() in (\"quit\", \"exit\", \"q\"):\n            break\n\n        results = db.search_by_name(search_term)\n        print(f\"\\nFound {len(results)} matching entities:\")\n        for i, entity in enumerate(results[:5], 1):\n            doc_preview = f\" - {entity.docstring[:50]}...\" if entity.docstring else \"\"\n            print(\n                f\"  {i}. {entity.type.title()}: {entity.name} (in {entity.file}:{entity.lineno}){doc_preview}\"\n            )\n\n        if len(results) > 5:\n            print(f\"  ... and {len(results) - 5} more results\")\n        elif not results:\n            print(\"  No results found. Try a different search term.\")\n",
  "metadata": {},
  "relative_path": "hypercode_db.py",
  "id": "7d4eecac4ec7d0739fbe44f8b6804807"
}