{
  "file_name": "models.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\hypercode\\new files to check\\backend\\research\\models.py",
  "file_size": 7564,
  "created": "2025-11-30T20:22:52.753964",
  "modified": "2025-12-04T00:56:57.667706",
  "file_type": "code",
  "content_hash": "896395f3ff501be95e14d1cad6368e49",
  "content_type": "text",
  "content": "\"\"\"\nORM models for the HyperCode research database.\n\nThis module defines the core entities needed to store research\nprojects, source materials, language versions, tasks, participants,\nsessions, low‑level event logs and qualitative feedback.  The\nschema is designed to be extensible and normalised so that\ndifferent types of analysis can be performed without rewriting\nqueries each time.\n\nIf you add or modify models in this file you will need to create\nand run a new Alembic migration to reflect the changes in your\ndatabase.  See the repository documentation for instructions on\ninitialising and running migrations.\n\"\"\"\n\nfrom datetime import datetime\nfrom sqlalchemy import (\n    Column,\n    Integer,\n    BigInteger,\n    Text,\n    DateTime,\n    ForeignKey,\n    JSON,\n)\nfrom sqlalchemy.dialects.postgresql import ARRAY\n\nfrom .db import Base\n\n\nclass Study(Base):\n    \"\"\"Top‑level research study.\n\n    Each research endeavour (for example, \"ADHD editing patterns in\n    HyperCode v0.3\") is represented by a Study.  Studies have\n    optional tags for categorisation and can be linked to multiple\n    sources, tasks and sessions.\n    \"\"\"\n\n    __tablename__ = \"studies\"\n\n    id = Column(Integer, primary_key=True)\n    slug = Column(Text, unique=True, nullable=False)\n    title = Column(Text, nullable=False)\n    description = Column(Text)\n    status = Column(Text, nullable=False, default=\"planned\")\n    started_at = Column(DateTime(timezone=True))\n    completed_at = Column(DateTime(timezone=True))\n    tags = Column(ARRAY(Text), default=list)\n\n    def __repr__(self) -> str:\n        return f\"<Study slug={self.slug!r} title={self.title!r}>\"\n\n\nclass Source(Base):\n    \"\"\"External or internal resource used in a study.\n\n    Examples include published papers, blog posts, videos, design\n    documents or spec notes.  The ``storage_path`` points to the\n    persisted location of the source material if it exists on disk or\n    in object storage.  The optional ``summary`` can store a human or\n    machine generated abstract of the resource.\n    \"\"\"\n\n    __tablename__ = \"sources\"\n\n    id = Column(Integer, primary_key=True)\n    study_id = Column(Integer, ForeignKey(\"studies.id\", ondelete=\"SET NULL\"))\n    title = Column(Text, nullable=False)\n    kind = Column(Text, nullable=False)\n    url = Column(Text)\n    storage_path = Column(Text)\n    summary = Column(Text)\n    imported_at = Column(DateTime(timezone=True), default=datetime.utcnow)\n\n    # embedding column can be added later if using pgvector\n    # from sqlalchemy.dialects.postgresql import VECTOR\n    # embedding = Column(VECTOR(1536))\n\n    def __repr__(self) -> str:\n        return f\"<Source title={self.title!r} kind={self.kind!r}>\"\n\n\nclass LanguageVersion(Base):\n    \"\"\"Version of the HyperCode language.\n\n    Tracks semantic changes and meta information about a particular\n    version of HyperCode.  The optional ``spec_source_id`` can be\n    linked to a Source row representing the language specification.\n    \"\"\"\n\n    __tablename__ = \"language_versions\"\n\n    id = Column(Integer, primary_key=True)\n    version = Column(Text, unique=True, nullable=False)\n    codename = Column(Text)\n    released_at = Column(DateTime(timezone=True))\n    changelog = Column(Text)\n    spec_source_id = Column(Integer, ForeignKey(\"sources.id\"))\n\n    def __repr__(self) -> str:\n        return f\"<LanguageVersion version={self.version!r}>\"\n\n\nclass Task(Base):\n    \"\"\"A coding task or challenge used in experiments.\n\n    Tasks describe the problem statement and any relevant metadata so\n    that results can be compared across participants and language\n    versions.\n    \"\"\"\n\n    __tablename__ = \"tasks\"\n\n    id = Column(Integer, primary_key=True)\n    slug = Column(Text, unique=True, nullable=False)\n    title = Column(Text, nullable=False)\n    description = Column(Text, nullable=False)\n    difficulty = Column(Text)\n    cognitive_focus = Column(Text)\n    tags = Column(ARRAY(Text), default=list)\n\n    def __repr__(self) -> str:\n        return f\"<Task slug={self.slug!r} title={self.title!r}>\"\n\n\nclass Participant(Base):\n    \"\"\"An anonymised participant in the study.\n\n    Participants are keyed by a code rather than a real identity to\n    preserve privacy.  Additional demographic information could be\n    stored here if needed (for example, ND profile flags).\n    \"\"\"\n\n    __tablename__ = \"participants\"\n\n    id = Column(Integer, primary_key=True)\n    anon_code = Column(Text, unique=True, nullable=False)\n    profile_notes = Column(Text)\n    nd_profile = Column(ARRAY(Text), default=list)\n    created_at = Column(DateTime(timezone=True), default=datetime.utcnow)\n\n    def __repr__(self) -> str:\n        return f\"<Participant anon_code={self.anon_code!r}>\"\n\n\nclass Session(Base):\n    \"\"\"A single coding session of a participant performing a task.\n\n    A session links together a study, participant, task and language\n    version.  It captures metadata about the environment and an\n    optional free form note field for the researcher.\n    \"\"\"\n\n    __tablename__ = \"sessions\"\n\n    id = Column(Integer, primary_key=True)\n    study_id = Column(Integer, ForeignKey(\"studies.id\"))\n    participant_id = Column(Integer, ForeignKey(\"participants.id\"))\n    task_id = Column(Integer, ForeignKey(\"tasks.id\"))\n    language_version_id = Column(Integer, ForeignKey(\"language_versions.id\"))\n\n    started_at = Column(DateTime(timezone=True), nullable=False)\n    ended_at = Column(DateTime(timezone=True))\n    environment = Column(JSON, default=dict)\n    notes = Column(Text)\n\n    def __repr__(self) -> str:\n        return (\n            f\"<Session id={self.id} participant_id={self.participant_id}\"\n            f\" task_id={self.task_id} language_version_id={self.language_version_id}>\"\n        )\n\n\nclass Event(Base):\n    \"\"\"Low‑level interaction within a session.\n\n    Events capture keystrokes, runs, errors, completions or any\n    arbitrary interaction that occurs during a coding session.  The\n    ``data`` column stores a flexible payload to accommodate\n    different kinds of events.\n    \"\"\"\n\n    __tablename__ = \"events\"\n\n    id = Column(BigInteger, primary_key=True)\n    session_id = Column(Integer, ForeignKey(\"sessions.id\", ondelete=\"CASCADE\"))\n    ts = Column(DateTime(timezone=True), nullable=False)\n    event_type = Column(Text, nullable=False)\n    data = Column(JSON, default=dict)\n\n    def __repr__(self) -> str:\n        return (\n            f\"<Event id={self.id} session_id={self.session_id} type={self.event_type}>\"\n        )\n\n\nclass Feedback(Base):\n    \"\"\"Qualitative and quantitative feedback for a session.\n\n    Stores ratings for flow, clarity and frustration along with\n    free‑form comments.  Additional embedding support can be added\n    later for semantic searches.\n    \"\"\"\n\n    __tablename__ = \"feedback\"\n\n    id = Column(Integer, primary_key=True)\n    session_id = Column(Integer, ForeignKey(\"sessions.id\", ondelete=\"CASCADE\"))\n    created_at = Column(DateTime(timezone=True), default=datetime.utcnow)\n    rating_flow = Column(Integer)\n    rating_clarity = Column(Integer)\n    rating_frustration = Column(Integer)\n    free_text = Column(Text)\n\n    # embedding column can be added later\n    # from sqlalchemy.dialects.postgresql import VECTOR\n    # embedding = Column(VECTOR(1536))\n\n    def __repr__(self) -> str:\n        return f\"<Feedback id={self.id} session_id={self.session_id}>\"\n",
  "metadata": {},
  "relative_path": "hypercode\\new files to check\\backend\\research\\models.py",
  "id": "acc9c2389ff6dde7cb70e927b6710b44"
}