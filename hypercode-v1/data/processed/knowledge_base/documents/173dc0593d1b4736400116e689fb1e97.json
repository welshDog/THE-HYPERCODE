{
  "file_name": "hypercode-backend-js-COMPLETE.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\hypercode\\src\\hypercode-backend-js-COMPLETE.py",
  "file_size": 7283,
  "created": "2025-11-26T23:37:35.621823",
  "modified": "2025-11-26T23:37:35.621823",
  "file_type": "code",
  "content_hash": "1869afdd3a637a4facadb9045ef0fc75",
  "content_type": "text",
  "content": "\"\"\"\nHyperCode JavaScript Backend - Complete Implementation\nCompiles HyperCode AST to executable JavaScript\n\nFeatures:\n- Memory tape simulation\n- Optimized loop generation\n- Error handling\n- Readable output\n- Minification option\n\"\"\"\n\nimport sys\n\n# Import parser (assumes hypercode-parser-COMPLETE.py)\nfrom hypercode_parser_COMPLETE import ASTNode, NodeType\n\n\nclass JSCompiler:\n    \"\"\"\n    Compiles HyperCode AST to JavaScript.\n\n    Output format:\n    - Runs in Node.js or browser\n    - Uses Uint8Array for memory tape\n    - Implements all core operations\n    - Includes runtime error checking\n    \"\"\"\n\n    def __init__(self, ast: ASTNode, optimize: bool = True):\n        \"\"\"\n        Initialize compiler.\n\n        Args:\n            ast: Root AST node (PROGRAM)\n            optimize: Enable optimizations\n        \"\"\"\n        self.ast = ast\n        self.optimize = optimize\n        self.indent_level = 0\n\n    def compile(self) -> str:\n        \"\"\"\n        Compile AST to JavaScript.\n\n        Returns:\n            JavaScript source code\n        \"\"\"\n        js_code = []\n\n        # Header\n        js_code.append(self._generate_header())\n\n        # Setup\n        js_code.append(self._generate_setup())\n\n        # Main program\n        js_code.append(self._generate_main(self.ast))\n\n        # Footer\n        js_code.append(self._generate_footer())\n\n        return \"\\n\".join(js_code)\n\n    def _generate_header(self) -> str:\n        \"\"\"Generate JavaScript header\"\"\"\n        return \"\"\"// HyperCode → JavaScript\n// Compiled by HyperCode Compiler\n// https://github.com/welshDog/hypercode\n\n'use strict';\n\"\"\"\n\n    def _generate_setup(self) -> str:\n        \"\"\"Generate setup code (memory tape, pointer, I/O)\"\"\"\n        return \"\"\"\n// Setup memory tape (30,000 cells, standard Brainfuck size)\nconst MEMORY_SIZE = 30000;\nconst memory = new Uint8Array(MEMORY_SIZE);\nlet pointer = 0;\n\n// Input/Output buffers\nlet inputBuffer = [];\nlet outputBuffer = [];\n\n// Helper: Read character from input\nfunction readChar() {\n    if (inputBuffer.length === 0) {\n        throw new Error('Attempted to read from empty input buffer');\n    }\n    return inputBuffer.shift();\n}\n\n// Helper: Write character to output\nfunction writeChar(value) {\n    outputBuffer.push(String.fromCharCode(value));\n}\n\n// Helper: Bounds check\nfunction checkBounds() {\n    if (pointer < 0 || pointer >= MEMORY_SIZE) {\n        throw new Error(`Memory access out of bounds: pointer=${pointer}`);\n    }\n}\n\n// Main program function\nfunction main() {\n\"\"\"\n\n    def _generate_main(self, node: ASTNode) -> str:\n        \"\"\"\n        Generate JavaScript for AST node.\n\n        Args:\n            node: AST node\n\n        Returns:\n            JavaScript code\n        \"\"\"\n        code = []\n\n        if node.node_type == NodeType.PROGRAM:\n            for child in node.children:\n                code.append(self._generate_main(child))\n\n        elif node.node_type == NodeType.PUSH:\n            code.append(f\"{self._indent()}pointer++;\")\n            code.append(f\"{self._indent()}checkBounds();\")\n\n        elif node.node_type == NodeType.POP:\n            code.append(f\"{self._indent()}pointer--;\")\n            code.append(f\"{self._indent()}checkBounds();\")\n\n        elif node.node_type == NodeType.INCR:\n            code.append(f\"{self._indent()}memory[pointer]++;\")\n\n        elif node.node_type == NodeType.DECR:\n            code.append(f\"{self._indent()}memory[pointer]--;\")\n\n        elif node.node_type == NodeType.OUTPUT:\n            code.append(f\"{self._indent()}writeChar(memory[pointer]);\")\n\n        elif node.node_type == NodeType.INPUT:\n            code.append(f\"{self._indent()}memory[pointer] = readChar();\")\n\n        elif node.node_type == NodeType.LOOP:\n            code.append(f\"{self._indent()}while (memory[pointer] !== 0) {{\")\n            self.indent_level += 1\n            for child in node.children:\n                code.append(self._generate_main(child))\n            self.indent_level -= 1\n            code.append(f\"{self._indent()}}}\")\n\n        elif node.node_type == NodeType.SPATIAL_2D:\n            code.append(f\"{self._indent()}// Spatial 2D mode (future implementation)\")\n\n        elif node.node_type == NodeType.AI_NATIVE:\n            code.append(f\"{self._indent()}// AI-native marker (future implementation)\")\n\n        return \"\\n\".join(code)\n\n    def _generate_footer(self) -> str:\n        \"\"\"Generate JavaScript footer\"\"\"\n        return \"\"\"}\n\n// Execute program\ntry {\n    main();\n\n    // Print output\n    console.log(outputBuffer.join(''));\n\n} catch (error) {\n    console.error('Runtime Error:', error.message);\n    process.exit(1);\n}\n\"\"\"\n\n    def _indent(self) -> str:\n        \"\"\"Get current indentation\"\"\"\n        return \"    \" * self.indent_level\n\n    def optimize_ast(self, node: ASTNode) -> ASTNode:\n        \"\"\"\n        Optimize AST (future: loop unrolling, dead code elimination).\n\n        Args:\n            node: AST node\n\n        Returns:\n            Optimized AST node\n        \"\"\"\n        # TODO: Implement optimizations\n        # - Collapse consecutive increments/decrements\n        # - Loop unrolling for small loops\n        # - Dead code elimination\n        return node\n\n\ndef main():\n    \"\"\"CLI interface for JavaScript backend\"\"\"\n    import argparse\n\n    from hypercode_lexer_COMPLETE import HyperCodeLexer, LexerError\n    from hypercode_parser_COMPLETE import HyperCodeParser, ParserError\n\n    parser = argparse.ArgumentParser(\n        description=\"HyperCode JavaScript Backend - Compile to JavaScript\",\n        formatter_class=argparse.RawDescriptionHelpFormatter,\n        epilog=\"\"\"\nExamples:\n  python backend_javascript.py program.hc -o program.js\n  python backend_javascript.py program.hc --optimize\n  node program.js\n        \"\"\",\n    )\n\n    parser.add_argument(\"input\", help=\"HyperCode source file (.hc)\")\n    parser.add_argument(\n        \"-o\", \"--output\", help=\"Output JavaScript file (default: stdout)\", default=None\n    )\n    parser.add_argument(\"--optimize\", action=\"store_true\", help=\"Enable optimizations\")\n\n    args = parser.parse_args()\n\n    # Read source\n    try:\n        with open(args.input, \"r\") as f:\n            source = f.read()\n    except FileNotFoundError:\n        print(f\"❌ Error: File not found: {args.input}\", file=sys.stderr)\n        return 1\n\n    # Compile pipeline: Lex → Parse → Compile\n    try:\n        # Lex\n        lexer = HyperCodeLexer(source, args.input)\n        tokens = lexer.tokenize()\n\n        # Parse\n        hc_parser = HyperCodeParser(tokens)\n        ast = hc_parser.parse()\n\n        # Compile\n        compiler = JSCompiler(ast, optimize=args.optimize)\n        js_code = compiler.compile()\n\n        # Output\n        if args.output:\n            with open(args.output, \"w\") as f:\n                f.write(js_code)\n            print(f\"✅ Compiled to JavaScript: {args.output}\")\n        else:\n            print(js_code)\n\n        return 0\n\n    except (LexerError, ParserError) as e:\n        print(f\"❌ Compilation Error: {e}\", file=sys.stderr)\n        return 1\n\n\nif __name__ == \"__main__\":\n    sys.exit(main())\n",
  "metadata": {},
  "relative_path": "hypercode\\src\\hypercode-backend-js-COMPLETE.py",
  "id": "173dc0593d1b4736400116e689fb1e97"
}