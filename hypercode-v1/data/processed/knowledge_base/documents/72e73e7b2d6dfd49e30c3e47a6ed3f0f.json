{
  "file_name": "test_mcp_connection.py",
  "file_path": "C:\\Users\\lyndz\\Downloads\\hypercode PROJECT\\hypercode\\scripts\\test_mcp_connection.py",
  "file_size": 5339,
  "created": "2025-11-29T01:56:39.754377",
  "modified": "2025-11-29T01:56:39.754377",
  "file_type": "code",
  "content_hash": "65c491ac0697a12271d77aaa0bffb2c4",
  "content_type": "text",
  "content": "import requests\nimport socket\nimport json\nimport subprocess\nfrom typing import Dict, Any, List, Optional, Tuple\n\n# List of MCP servers from the README\nMCP_SERVERS = [\n    \"valkey_service\",\n    \"dataset_downloader\",\n    \"user_profile_manager\",\n    \"aws_resource_manager\",\n    \"path_service\",\n    \"file_system\",\n    \"code_analysis\",\n    \"web_search\",\n    \"human_input\",\n    \"aws_cli\",\n    \"hypercode_syntax\"\n]\n\n# Common ports to check\nCOMMON_PORTS = [8000, 8080, 5000, 3000, 9000]\n\ndef check_port(host: str, port: int, timeout: float = 1.0) -> bool:\n    \"\"\"Check if a port is open on the given host.\"\"\"\n    try:\n        with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\n            s.settimeout(timeout)\n            return s.connect_ex((host, port)) == 0\n    except Exception:\n        return False\n\ndef find_running_servers(host: str = 'localhost') -> List[Tuple[str, int]]:\n    \"\"\"Scan common ports to find running servers.\"\"\"\n    print(\"\\nScanning for running servers on common ports...\")\n    running_servers = []\n    \n    for port in COMMON_PORTS:\n        if check_port(host, port):\n            running_servers.append(('http', host, port))\n            print(f\"✅ Found server running on {host}:{port}\")\n    \n    return running_servers\n\ndef test_server_connection(server_name: str, base_url: str = None, port: int = None) -> Dict[str, Any]:\n    \"\"\"Test connection to a single MCP server.\"\"\"\n    endpoints = ['/health', '/', f'/{server_name}/health', f'/{server_name}']\n    \n    # Try different URL patterns\n    if base_url:\n        urls_to_try = [f\"{base_url.rstrip('/')}/{server_name}{endpoint}\" for endpoint in endpoints]\n        urls_to_try.append(base_url)  # Also try the base URL directly\n    else:\n        # If no base URL, try with and without the server name in the path\n        urls_to_try = []\n        for port in ([port] if port else COMMON_PORTS):\n            urls_to_try.extend([\n                f\"http://localhost:{port}{endpoint}\" for endpoint in endpoints\n            ])\n    \n    for url in urls_to_try:\n        try:\n            response = requests.get(url, timeout=2)\n            if response.status_code < 500:  # Accept any non-5xx status code\n                return {\n                    \"status\": \"success\",\n                    \"server\": server_name,\n                    \"url\": url,\n                    \"status_code\": response.status_code,\n                    \"response\": response.json() if response.content else \"No content\"\n                }\n        except (requests.RequestException, json.JSONDecodeError):\n            continue\n    \n    return {\n        \"status\": \"error\",\n        \"server\": server_name,\n        \"error\": f\"Could not connect to any known endpoints\"\n    }\n\ndef test_all_servers():\n    \"\"\"Test connection to all MCP servers and print results.\"\"\"\n    print(\"Testing connections to MCP servers...\\n\")\n    \n    # First, try to find any running servers\n    running_servers = find_running_servers()\n    \n    if not running_servers:\n        print(\"\\n❌ No running servers detected on common ports. Please ensure the MCP servers are running.\")\n        print(\"\\nTo start the MCP servers, you might need to run a command like:\")\n        print(\"  python -m mcp.servers  # or check the project's documentation\")\n        return []\n    \n    print(\"\\nTesting each MCP service...\\n\")\n    \n    results = []\n    for server in MCP_SERVERS:\n        print(f\"Testing {server}...\")\n        \n        # Try each running server\n        for protocol, host, port in running_servers:\n            base_url = f\"{protocol}://{host}:{port}\"\n            result = test_server_connection(server, base_url, port)\n            if result[\"status\"] == \"success\":\n                break\n        else:\n            # If no success with any server, try without base URL\n            result = test_server_connection(server)\n        \n        results.append(result)\n        \n        # Print status with color coding\n        if result[\"status\"] == \"success\":\n            print(f\"✅ {server}: Connected successfully at {result.get('url', 'unknown')}\")\n            if 'response' in result and result['response'] != \"No content\":\n                print(f\"   Response: {json.dumps(result['response'], indent=2)}\")\n        else:\n            print(f\"❌ {server}: {result.get('error', 'Could not connect to any known endpoints')}\")\n        print(\"-\" * 50)\n    \n    return results\n\ndef check_dependencies():\n    \"\"\"Check if required dependencies are installed.\"\"\"\n    try:\n        import requests\n        return True\n    except ImportError:\n        print(\"\\n❌ The 'requests' package is required but not installed.\")\n        print(\"Install it with: pip install requests\")\n        return False\n\nif __name__ == \"__main__\":\n    if check_dependencies():\n        test_all_servers()\n        \n        print(\"\\nTroubleshooting Tips:\")\n        print(\"1. Make sure the MCP servers are running\")\n        print(\"2. Check if the servers are running on non-standard ports\")\n        print(\"3. Verify that the server URLs match the expected format\")\n        print(\"4. Check if there are any firewall rules blocking the connections\")\n        print(\"\\nFor more help, check the project's documentation or README file.\")\n",
  "metadata": {},
  "relative_path": "scripts\\test_mcp_connection.py",
  "id": "72e73e7b2d6dfd49e30c3e47a6ed3f0f"
}